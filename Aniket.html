<!DOCTYPE html>
<html lang="en" class="h-full">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZealAudio Music Player</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Lato:wght@400;700&family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        /* Custom Styles */

        body {
            font-family: 'Inter', sans-serif;
            background-color: #8f8682;
            /* Dark background from Tailwind gray-800 */
        }

        .fcc-title,
        .playlist-title,
        .navbar-logo {
            font-family: 'Roboto Mono', monospace;
            font-weight: 700;
        }

        .player-section {
            background-color: #948980;
            /* Tailwind gray-900 equivalent */
            border: 1px solid #374151;
        }

        #pause {
            display: none;
        }

        .playing #play {
            display: none;
        }

        .playing #pause {
            display: inline-block;
        }

        /* Scrollbar Styling for Playlist */
        #playlist-songs::-webkit-scrollbar {
            width: 8px;
        }

        #playlist-songs::-webkit-scrollbar-track {
            background: #374151;
        }

        #playlist-songs::-webkit-scrollbar-thumb {
            background: #4f46e5;
            border-radius: 4px;
        }

        #playlist-songs::-webkit-scrollbar-thumb:hover {
            background: #6366f1;
        }

        /* Range Input (Progress/Volume) Styling */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #4b5563;
            border-radius: 4px;
            outline: none;
            transition: opacity .2s;
            cursor: pointer;
        }

        input[type="range"]:hover {
            opacity: 1;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #6366f1;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(99, 102, 241, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #6366f1;
            border-radius: 50%;
            cursor: pointer;
        }

        /* Current Song Highlight */
        .playlist-song[aria-current="true"] {
            background-color: #4f46e5;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }

        .playlist-song[aria-current="true"] .playlist-song-artist,
        .playlist-song[aria-current="true"] .playlist-song-duration {
            color: #e5e7eb;
        }

        /* Auth Modal Styling */
        .signin-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(8px);
        }

        .signin-modal.hidden {
            display: none;
        }

        .signin-content {
            max-width: 450px;
            width: 90%;
            background: #1f2937;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transform: scale(1);
            transition: transform 0.3s ease-out;
        }

        .signin-modal.hidden .signin-content {
            transform: scale(0.95);
        }

        .signin-visual {
            height: 150px;
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            display: flex;
            align-items: flex-end;
            padding: 2rem;
            color: white;
        }

        /* Player Controls Hover Effects */
        .control-btn {
            transition: color 0.2s, transform 0.1s;
            color: #9ca3af;
        }

        .control-btn:hover {
            color: #6366f1 !important;
            transform: scale(1.1);
        }

        .control-btn.text-2xl:hover {
            transform: scale(1.2);
        }

        .control-btn.text-4xl:hover {
            transform: scale(1.05);
        }

        .playlist-song {
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
        }

        .playlist-song:hover {
            background: #374151;
            transform: translateX(4px);
        }

        /* Front Page Styles */
        .front-page {
            background-image: url(./image123.webp);
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-size: cover;
            background-size: 100%;
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            padding: 2rem;
        }

        .front-page h1 {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .front-page p {
            font-size: 1.25rem;
            margin-bottom: 2rem;
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            max-width: 800px;
            width: 100%;
        }

        .gallery img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            transition: transform 0.3s;
        }

        .gallery img:hover {
            transform: scale(1.05);
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-200 h-full">
    <!-- Notification Message Box -->
    <div id="notification-box"
        class="fixed top-20 right-4 p-4 rounded-lg text-white shadow-xl transition-opacity duration-300 opacity-0 z-50 pointer-events-none">
    </div>

    <!-- Navigation Bar -->
    <nav class="navbar bg-gray-800 shadow-xl p-4 flex justify-between items-center fixed top-0 w-full z-50">
        <div class="navbar-logo text-2xl text-indigo-400">ðŸŽµ ZealStudio</div>
        <ul class="navbar-links flex space-x-4">
            <li><a href="#" onclick="showFrontPage()" class="hover:text-indigo-400 font-medium">Home</a></li>
            <li><a href="#playlist" onclick="checkAuthAndShowContent()"
                    class="hover:text-indigo-400 font-medium">Playlist</a></li>
            <li id="auth-link"><a href="#" onclick="toggleAuthModal()"
                    class="text-white hover:text-indigo-300 font-bold px-3 py-1 bg-indigo-600 rounded-full transition duration-150">Sign
                    In</a></li>
        </ul>
        <div id="logout-btn" class="hidden"><button onclick="logout()"
                class="text-red-400 hover:text-red-300 font-medium py-1 px-3 border border-red-400 rounded-full transition duration-150">Logout</button>
        </div>
    </nav>

    <!-- Front Page -->
    <div id="front-page" class="front-page">
        <h1>Welcome to ZealAudio</h1>
        <p>Discover, play, and enjoy your favorite music with our sleek audio player.</p>
        <div class="gallery">
            <img src="/Images/image1/image2.jpeg" alt="Music Scene 1">
            <img src="/Images/image1/image3.jpg" alt="Music Scene 2">
            <img src="/Images/image1/image4.jpeg" alt="Music Scene 3">
            <img src="/Images/image1/image5.jpeg" alt="Music Scene 4">
            <img src="/Images/image1/image6.jpeg" alt="Music Scene 5">
            <img src="/Images/image1/image7.jpeg" alt="Music Scene 6">
        </div>
        <button onclick="toggleAuthModal()"
            class="mt-8 bg-indigo-600 text-white py-3 px-6 rounded-lg hover:bg-indigo-700 transition duration-150">Get
            Enjoy</button>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="signin-modal hidden">
        <div class="signin-content">
            <div class="signin-visual">
                <div>
                    <h1 class="text-2xl font-bold mb-1">Aura Music</h1>
                    <p class="text-white/80 text-sm">Sign in or up to unlock your personalized music world.</p>
                </div>
            </div>
            <div class="signin-form">
                <div class="mb-6 text-left">
                    <h3 id="modal-title" class="text-2xl font-bold mb-1 text-indigo-400">Welcome Back</h3>
                    <p id="modal-subtitle" class="text-gray-400">Please enter your details to continue.</p>
                </div>
                <!-- Sign In Form -->
                <form id="signin-form" class="space-y-4">
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-300">Email</label>
                        <input id="email" type="email" required
                            class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white focus:ring-indigo-500 focus:border-indigo-500 mt-1"
                            placeholder="user@example.com">
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-300">Password</label>
                        <input id="password" type="password" required
                            class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white focus:ring-indigo-500 focus:border-indigo-500 mt-1"
                            placeholder="Password (min 6 chars)">
                    </div>
                    <button type="submit"
                        class="w-full py-3 px-4 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-150 shadow-lg">Sign
                        In</button>
                </form>
                <!-- Sign Up Form -->
                <form id="signup-form" class="space-y-4" style="display: none;">
                    <div>
                        <label for="signup-email" class="block text-sm font-medium text-gray-300">Email</label>
                        <input id="signup-email" type="email" required
                            class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white focus:ring-green-500 focus:border-green-500 mt-1"
                            placeholder="user@example.com">
                    </div>
                    <div>
                        <label for="signup-password" class="block text-sm font-medium text-gray-300">Password (min 6
                            chars)</label>
                        <input id="signup-password" type="password" required minlength="6"
                            class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white focus:ring-green-500 focus:border-green-500 mt-1"
                            placeholder="Password (min 6 chars)">
                    </div>
                    <button type="submit"
                        class="w-full py-3 px-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition duration-150 shadow-lg">Sign
                        Up</button>
                </form>

                <div class="mt-6 text-center">
                    <button id="toggle-form" class="text-indigo-400 hover:text-indigo-300 text-sm font-medium">Don't
                        have an account? Sign up</button>
                </div>

                <!-- Social Placeholders -->
                <div class="mt-8">
                    <div class="relative">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t border-gray-700"></div>
                        </div>
                        <div class="relative flex justify-center text-sm"><span
                                class="px-2 bg-gray-800 text-gray-400 rounded-full">Or connect</span></div>
                    </div>
                    <div class="mt-6 grid grid-cols-2 gap-4">
                        <button onclick="simulateSocialLogin('Google')"
                            class="py-3 px-4 border border-gray-600 rounded-lg bg-gray-700 text-gray-300 hover:bg-gray-600 transition duration-150 flex items-center justify-center"><i
                                class="fab fa-google mr-2 text-red-500"></i> Google</button>
                        <button onclick="simulateSocialLogin('Apple')"
                            class="py-3 px-4 border border-gray-600 rounded-lg bg-gray-700 text-gray-300 hover:bg-gray-600 transition duration-150 flex items-center justify-center"><i
                                class="fab fa-apple mr-2 text-white"></i> Apple</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="main-content" class="pt-20 hidden min-h-screen">
        <div class="container mx-auto p-4 md:p-8 grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Player Section -->
            <div class="player-section rounded-xl p-8 shadow-2xl h-fit sticky top-24">
                <div class="fcc-title text-3xl font-bold text-center mb-6 text-indigo-400">ZealAudio Player</div>
                <div class="artwork mx-auto mb-6">
                    <img id="artwork" src="https://via.placeholder.com/192x192?text=Cover" alt="Album Art"
                        class="w-56 h-56 rounded-xl shadow-xl mx-auto block object-cover transform hover:scale-105 transition duration-300">
                </div>
                <div class="track-info text-center mb-8">
                    <h2 id="track-title" class="text-2xl font-extrabold text-white truncate">Select a song</h2>
                    <p id="track-artist" class="text-indigo-300 text-lg font-medium">Artist</p>
                </div>

                <div class="progress mb-6">
                    <div class="flex items-center justify-between text-xs mb-2 text-gray-400">
                        <span id="current-time">0:00</span>
                        <span id="duration">0:00</span>
                    </div>
                    <input type="range" id="progress" min="0" max="100" value="0" class="w-full">
                </div>

                <div class="controls flex items-center justify-center space-x-8 mb-8">
                    <button id="shuffle" class="control-btn text-gray-400 text-lg"><i
                            class="fas fa-random"></i></button>
                    <button id="prev" class="control-btn text-2xl text-white hover:text-indigo-400"><i
                            class="fas fa-backward"></i></button>
                    <button id="play" class="control-btn text-5xl text-indigo-400"><i class="fas fa-play"></i></button>
                    <button id="pause" class="control-btn text-5xl text-indigo-400"><i
                            class="fas fa-pause"></i></button>
                    <button id="next" class="control-btn text-2xl text-white hover:text-indigo-400"><i
                            class="fas fa-forward"></i></button>
                    <button id="repeat" class="control-btn text-gray-400 text-lg"><i class="fas fa-redo"></i></button>
                </div>

                <div class="volume flex items-center justify-center space-x-4 p-2 bg-gray-700 rounded-full">
                    <i class="fas fa-volume-down text-gray-400"></i>
                    <input type="range" id="volume" min="0" max="100" value="50" class="w-32">
                    <i class="fas fa-volume-up text-gray-400"></i>
                </div>
                <audio id="audio" preload="metadata"></audio>
            </div>

            <!-- Playlist Section -->
            <div class="playlist-section bg-gray-800 rounded-xl p-6 shadow-2xl" id="playlist">

                <h3 id="playlist-title-count"
                    class="playlist-title text-2xl font-bold mb-4 text-white border-b border-gray-700 pb-2">Your
                    Playlist (6 Tracks)</h3>
                <div id="playlist-songs" class="space-y-2 max-h-[480px] lg:max-h-[70vh] overflow-y-auto">

                    <!-- Playlist Songs will be rendered here -->
                </div>
                <button id="add-song"
                    class="mt-6 w-full bg-indigo-600 text-white py-3 rounded-xl hover:bg-indigo-700 font-bold transition duration-150 shadow-md">
                    <i class="fas fa-plus mr-2"></i> Add New Song (Placeholder)
                </button>
            </div>
        </div>
    </div>

    <script>

        // --- Custom Notification Implementation (Replaces alert() & confirm()) ---
        function showNotification(message, type = 'success') {
            const box = document.getElementById('notification-box');
            box.textContent = message;

            // Set background color based on type
            box.className = 'fixed top-20 right-4 p-4 rounded-lg shadow-xl transition-opacity duration-300 opacity-100 z-50 pointer-events-auto';
            if (type === 'success') {
                box.classList.add('bg-green-600');
            } else if (type === 'error') {
                box.classList.add('bg-red-600');
            } else {
                box.classList.add('bg-indigo-600');
            }

            setTimeout(() => {
                box.classList.remove('opacity-100');
                box.classList.add('opacity-0', 'pointer-events-none');
            }, 3000);
        }

        // --- Sample Playlist Data ---
        let playlist = [
            { title: "Sample Track 1 - Ambient", artist: "Artist 1", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3", duration: "3:45", cover: "https://picsum.photos/seed/music1/192/192" },
            { title: "Sample Track 2 - Energetic", artist: "Artist 2", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3", duration: "4:12", cover: "https://picsum.photos/seed/music2/192/192" },
            { title: "Sample Track 3 - Chill", artist: "Artist 3", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3", duration: "2:58", cover: "https://picsum.photos/seed/music3/192/192" },
            { title: "Sample Track 4 - Upbeat", artist: "Artist 4", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3", duration: "3:05", cover: "https://picsum.photos/seed/music4/192/192" },
            { title: "Sample Track 5 - Mellow", artist: "Artist 5", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3", duration: "4:40", cover: "https://picsum.photos/seed/music5/192/192" },
            { title: "Heeriye (Acoustic Cover)", artist: " Artist 6", src: "C:\Users\anike\Downloads\Audio.mp3", duration: "4:59", cover: "https://picsum.photos/seed/music6/192/192" }
        ];




        let currentIndex = 0;
        let isPlaying = false;
        let shuffleMode = false;
        let repeatMode = 'none'; // 'none', 'one', 'all'

        // --- DOM Elements ---
        const audio = document.getElementById('audio');
        const progress = document.getElementById('progress');
        const volume = document.getElementById('volume');
        const currentTimeEl = document.getElementById('current-time');
        const durationEl = document.getElementById('duration');
        const trackTitleEl = document.getElementById('track-title');
        const trackArtistEl = document.getElementById('track-artist');
        const artworkEl = document.getElementById('artwork');
        const playBtn = document.getElementById('play');
        const pauseBtn = document.getElementById('pause');
        const playlistSongsEl = document.getElementById('playlist-songs');
        const mainContentEl = document.getElementById('main-content');
        const authModal = document.getElementById('auth-modal');
        const authLink = document.getElementById('auth-link');
        const logoutBtn = document.getElementById('logout-btn');
        const toggleFormBtn = document.getElementById('toggle-form');
        const signInForm = document.getElementById('signin-form');
        const signUpForm = document.getElementById('signup-form');
        const modalTitle = document.getElementById('modal-title');
        const modalSubtitle = document.getElementById('modal-subtitle');
        const playerSection = document.querySelector('.player-section');
        const repeatBtn = document.getElementById('repeat');
        const shuffleBtn = document.getElementById('shuffle');

        // --- Utility Functions ---

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function updatePlayPauseClass() {
            if (isPlaying) {
                playerSection.classList.add('playing');
            } else {
                playerSection.classList.remove('playing');
            }
        }

        // --- Player Core Functions ---

        function loadTrack(index) {
            if (playlist.length === 0) return;
            currentIndex = index;
            const track = playlist[currentIndex];
            audio.src = track.src;
            trackTitleEl.textContent = track.title;
            trackArtistEl.textContent = track.artist;
            artworkEl.src = track.cover;

            // Reset progress on load
            progress.value = 0;
            currentTimeEl.textContent = '0:00';
            durationEl.textContent = track.duration || '0:00'; // Use placeholder duration until metadata loads

            // Highlight current song in playlist
            document.querySelectorAll('.playlist-song').forEach((el, i) => {
                if (i === currentIndex) {
                    el.setAttribute('aria-current', 'true');
                    el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    el.removeAttribute('aria-current');
                }
            });

            if (isPlaying) {
                audio.play().catch(e => console.error("Play failed:", e));
            }
        }

        function playTrack() {
            if (playlist.length === 0) {
                showNotification('The playlist is empty!', 'error');
                return;
            }
            if (audio.src === '' || !audio.src.includes(playlist[currentIndex].src)) {
                // First play or new track was loaded but not started

                loadTrack(currentIndex);
            }
            audio.play().then(() => {
                isPlaying = true;
                updatePlayPauseClass();
            }).catch(e => {
                console.error("Autoplay failed:", e);
                showNotification('Playback failed. Please interact with the player first.', 'error');
            });
        }

        function pauseTrack() {
            audio.pause();
            isPlaying = false;
            updatePlayPauseClass();
        }

        function nextTrack() {
            if (playlist.length === 0) return;
            if (shuffleMode) {
                let newIndex;
                do {
                    newIndex = Math.floor(Math.random() * playlist.length);
                } while (newIndex === currentIndex && playlist.length > 1);
                loadTrack(newIndex);
            } else {
                currentIndex = (currentIndex + 1) % playlist.length;
                loadTrack(currentIndex);
            }
            if (isPlaying) {
                playTrack();
            }
        }

        function prevTrack() {
            if (playlist.length === 0) return;
            if (audio.currentTime > 3) { // Restart song if less than 3 seconds elapsed
                audio.currentTime = 0;
            } else {
                currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
                loadTrack(currentIndex);
            }
            if (isPlaying) {
                
                playTrack();
            }
        }

        function toggleShuffle() {
            shuffleMode = !shuffleMode;
            shuffleBtn.classList.toggle('text-indigo-400', shuffleMode);
            shuffleBtn.classList.toggle('text-gray-400', !shuffleMode);

            if (shuffleMode) {
                showNotification('Shuffle Mode On', 'info');
            } else {
                showNotification('Shuffle Mode Off', 'info');
            }
        }

        function toggleRepeat() {
            if (repeatMode === 'none') {
                repeatMode = 'all';
                repeatBtn.classList.add('text-indigo-400');
                repeatBtn.querySelector('i').className = 'fas fa-redo';
                showNotification('Repeat All Mode', 'info');
            } else if (repeatMode === 'all') {
                repeatMode = 'one';
                repeatBtn.querySelector('i').className = 'fas fa-redo fa-spin-pulse';
                showNotification('Repeat One Mode', 'info');
            } else {
                repeatMode = 'none';
                repeatBtn.classList.remove('text-indigo-400');
                repeatBtn.querySelector('i').className = 'fas fa-redo';
                showNotification('Repeat Off Mode', 'info');
            }
        }

        // --- Player Event Handlers ---

        audio.addEventListener('loadedmetadata', () => {
            // Only update duration if it wasn't set from the playlist data
            if (audio.duration && isFinite(audio.duration)) {
                durationEl.textContent = formatTime(audio.duration);
            }
        });

        audio.addEventListener('timeupdate', () => {
            if (!audio.duration || isNaN(audio.duration)) return;
            const progressPercent = (audio.currentTime / audio.duration) * 100;
            progress.value = progressPercent;
            currentTimeEl.textContent = formatTime(audio.currentTime);
        });

        audio.addEventListener('ended', () => {
            if (repeatMode === 'one') {
                audio.currentTime = 0;
                playTrack();
            } else if (repeatMode === 'all' || shuffleMode) {
                nextTrack();
            } else {
                // End of playlist
                isPlaying = false;
                updatePlayPauseClass();
                progress.value = 0;
                currentTimeEl.textContent = formatTime(0);
                trackTitleEl.textContent = "Playback Ended";
                trackArtistEl.textContent = "Playlist complete";
                showNotification('Playlist finished playing.', 'info');
            }
        });

        progress.addEventListener('input', (e) => {
            const seekTime = (e.target.value / 100) * audio.duration;
            audio.currentTime = seekTime;
        });

        volume.addEventListener('input', (e) => {
            // Set audio volume (0.0 to 1.0)
            audio.volume = e.target.value / 100;
            const volumeIcon = document.querySelector('.volume i:first-child');
            if (audio.volume === 0) {
                volumeIcon.className = 'fas fa-volume-mute text-gray-400';
            } else if (audio.volume < 0.5) {
                volumeIcon.className = 'fas fa-volume-down text-gray-400';
            } else {
                volumeIcon.className = 'fas fa-volume-up text-gray-400';
            }
        });
        // Set initial volume
        audio.volume = volume.value / 100;

        // --- Playlist UI Rendering ---

        function renderPlaylist() {
            playlistSongsEl.innerHTML = '';
            playlist.forEach((track, index) => {
                const div = document.createElement('div');
                div.className = 'playlist-song flex justify-between items-center text-left text-gray-200 hover:bg-gray-700 p-3 rounded-lg';
                div.setAttribute('data-index', index);
                div.onclick = () => {
                    loadTrack(index);
                    playTrack();
                };

                div.innerHTML = `
                <div class="flex items-center space-x-3 truncate">
                    <span class="text-sm font-bold text-indigo-400">${index + 1}.</span>
                    <div>
                        <p class="font-medium truncate">${track.title}</p>
                        <p class="playlist-song-artist text-sm text-gray-400">${track.artist}</p>
                    </div>
                </div>
                <span class="playlist-song-duration text-sm text-gray-400 flex-shrink-0">${track.duration}</span>
            `;
                playlistSongsEl.appendChild(div);
            });
        }

        // --- Auth Modal & UI Functions ---

        function hideAuthModal() {
            authModal.classList.add('hidden');
        }

        function showMainContent() {
            mainContentEl.classList.remove('hidden');
        }

        function hideMainContent() {
            mainContentEl.classList.add('hidden');
        }

        function checkAuth() {
            return localStorage.getItem('token') !== null;
        }

        function updateAuthUI() {
            if (checkAuth()) {
                authLink.style.display = 'none';
                logoutBtn.classList.remove('hidden');
            } else {
                authLink.style.display = 'block';
                logoutBtn.classList.add('hidden');
            }
        }

        window.checkAuthAndShowContent = function () {
            if (checkAuth()) {
                showMainContent();
            } else {
                showNotification('Please sign in to access the music player.', 'error');
                toggleAuthModal();
            }
        }

        window.toggleAuthModal = function () {
            if (checkAuth()) {
                window.logout();
            } else {
                authModal.classList.remove('hidden');
                // Ensure sign-in form is visible on open
                signInForm.style.display = 'block';
                signUpForm.style.display = 'none';
                modalTitle.textContent = 'Welcome Back';
                modalSubtitle.textContent = 'Please enter your details to continue.';
                toggleFormBtn.textContent = "Don't have an account? Sign up";
            }
        }

        window.logout = function () {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            hideMainContent();
            updateAuthUI();
            pauseTrack(); // Stop music on logout
            showNotification('Logged out successfully!');
        }

        window.simulateSignIn = function (email, password) {
            if (email && password.length >= 6) {
                localStorage.setItem('token', 'fake-jwt-token');
                localStorage.setItem('user', JSON.stringify({ email }));
                hideAuthModal();
                showMainContent();
                updateAuthUI();
                loadTrack(currentIndex); // Load track after signing in
                showNotification('Signed in successfully!', 'success');
            } else {
                showNotification('Invalid credentials or password too short (min 6 chars).', 'error');
            }
        };

        window.simulateSignUp = function (email, password) {
            if (password.length >= 6) {
                localStorage.setItem('token', 'fake-jwt-token');
                localStorage.setItem('user', JSON.stringify({ email }));
                hideAuthModal();
                showMainContent();
                updateAuthUI();
                loadTrack(currentIndex); // Load track after signing up
                showNotification('Account created and signed in successfully!', 'success');
            } else {
                showNotification('Password must be at least 6 characters.', 'error');
            }
        };

        window.simulateSocialLogin = function (provider) {
            localStorage.setItem('token', 'fake-jwt-token');
            localStorage.setItem('user', JSON.stringify({ email: `${provider.toLowerCase()}@example.com` }));
            hideAuthModal();
            showMainContent();
            updateAuthUI();
            loadTrack(currentIndex);
            showNotification(`Signed in with ${provider}!`, 'success');
        }

        // --- Initialization ---

        document.addEventListener('DOMContentLoaded', () => {
            renderPlaylist();
            updateAuthUI();

            if (checkAuth()) {
                showMainContent();
                if (playlist.length > 0) {
                    loadTrack(0);
                }
            } else {
                hideMainContent();
            }

            // Toggle form logic
            toggleFormBtn.addEventListener('click', (e) => {
                e.preventDefault();
                const isSignIn = signInForm.style.display !== 'none';

                signInForm.style.display = isSignIn ? 'none' : 'block';
                signUpForm.style.display = isSignIn ? 'block' : 'none';

                modalTitle.textContent = isSignIn ? 'Create Account' : 'Welcome Back';
                modalSubtitle.textContent = isSignIn ? 'Join the vibe and unlock your music world.' : 'Please enter your details to continue.';
                toggleFormBtn.textContent = isSignIn ? "Already have an account? Sign in" : "Don't have an account? Sign up";
            });

            // Form submission handlers
            signInForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                simulateSignIn(email, password);
            });

            signUpForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                simulateSignUp(email, password);
            });

            // Player Control Listeners
            playBtn.addEventListener('click', playTrack);
            pauseBtn.addEventListener('click', pauseTrack);
            document.getElementById('next').addEventListener('click', nextTrack);
            document.getElementById('prev').addEventListener('click', prevTrack);
            shuffleBtn.addEventListener('click', toggleShuffle);
            repeatBtn.addEventListener('click', toggleRepeat);

            // Global listener to close modal on outside click
            authModal.addEventListener('click', (e) => {
                if (e.target === authModal) {
                    hideAuthModal();
                }
            });

            // Placeholder Add Song button
            document.getElementById('add-song').addEventListener('click', () => {
                showNotification('To add new songs, you would integrate this with a Firestore database or an external music API.', 'info');
            });
        });
    </script>